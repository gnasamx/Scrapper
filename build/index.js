!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){(function(e){var t=o(1);const n=o(2),r=o(3),i=o(4);var l=o(5);const a=o(6),s=o(7),c=o(8);o(9).config();var u=t();process.on("uncaughtException",(function(e){console.log("Uncaught exception! =>",e)})),process.on("unhandledRejection",(function(e){console.log("Unhandled rejection! => ",e)})),u.listen(process.env.PORT,()=>{console.log("App is running on port: ",process.env.PORT),c.scheduleJob("* * * * *",(function(){!async function(){let t=0;try{const c=await n.launch({headless:!0}),u=await c.newPage();u.setViewport({width:1280,height:926}),await u.goto("https://www.myntra.com/wishlist",{waitUntil:"load"}),await u.setDefaultNavigationTimeout(0),u.click(".wishlistLogin-button"),await u.waitForNavigation(),await u.type(".login-user-input-email",process.env.MYNTRA_USER),await u.type(".login-user-input-password",process.env.MYNTRA_PWD),u.click(".login-login-button"),await u.waitForNavigation(),console.log("Login successfully");const d=await async function(e,n,r=800){let i=[];try{for(t=await e.evaluate(o);i.length<t-1;)i=await e.evaluate(n),previousHeight=await e.evaluate("document.body.scrollHeight"),await e.evaluate("window.scrollTo(0, document.body.scrollHeight)"),await e.waitFor(r)}catch(e){console.log("error in scrapeInfiniteScrollItems: ",e)}return i}(u,(function(){const e=[],t=document.querySelectorAll(".itemcard-itemCard").length,o=document.querySelectorAll(".itemdetails-itemDetailsLabel"),n=document.querySelectorAll(".itemdetails-boldFont"),r=document.querySelectorAll(".itemcard-itemActions"),i=document.querySelectorAll(".itemcard-itemImage"),l=document.querySelectorAll(".itemcard-itemImageDiv");for(let a=0;a<t;a++)e.push({link:l[a].firstChild.getAttribute("href"),image:i[a].src,name:o[a].innerText,price:n[a].innerText.replace(/\D/g,""),inStock:2===r[a].childElementCount});return e}));i.writeFile("./today.json",d,{spaces:2});const p=await i.readFile("./today.json"),f=await i.readFile("./yesterday.json"),m=[];for(let e=0;e<t;e++)p[e].price>f[e].price&&m.push(p[e]);let g={"<>":"table",html:[{"<>":"tbody",html:[{"<>":"tr",html:[{"<>":"td",html:[{style:"Width:80px","<>":"img",src:"${image}"}]},{"<>":"td",html:[{style:"padding-left:20px;color:#94989f;line-height:1.7;font-size:12px"},{"<>":"span",text:"${name}",style:"color:#29303f;font-size:14px"},{"<>":"br"},{"<>":"span",text:"Rs. ${price}"}]}]}]}]},h=a.transform(m,g);r.writeFile("./template.hbs",h,t=>{if(t)throw new Error("Error while saving html template: ",t);var o;console.log("Template saved successfully"),m.length>0&&(o=l.createTransport({service:"gmail",auth:{user:process.env.GMAIL,pass:process.env.GMAIL_PWD}}),s.renderFile(e+"/template.hbs",(e,t)=>{if(e)throw new Error("Error while rendering html template: ",e);var n={from:process.env.GMAIL,to:process.env.GMAIL,subject:"Myntra | Price dropped alert",text:"Checkout below products",html:t};o.sendMail(n,(function(e,t){e?console.log("Error while sending email: ",e):(console.log("Email sent"),r.unlink("./yesterday.json",e=>{if(e)throw new Error("Error occured while deleting today.json")}),r.rename("./today.json","./yesterday.json",e=>{if(e)throw new Error("Error occured whlie renaming file yesterday.json")}))}))}))}),c.close(),console.log("Good bye")}catch(e){console.log("Something went wrong",e)}function o(){return parseInt(document.getElementsByClassName("index-count")[0].innerText)}}()}))})}).call(this,"/")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("puppeteer")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("jsonfile")},function(e,t){e.exports=require("nodemailer")},function(e,t){e.exports=require("node-json2html")},function(e,t){e.exports=require("ejs")},function(e,t){e.exports=require("node-schedule")},function(e,t){e.exports=require("dotenv")}]);